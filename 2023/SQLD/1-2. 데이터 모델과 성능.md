# 🚀 SQL 자격검정 실전문제



## 과목 I - 데이터 모델링의 이해

### 🌱 제 2장 데이터 모델과 성능

#### 성능데이터모델링이란?

* 데이터베이스 성능향상을 목적으로 설계단계의 데이터모델링 때 부터 성능과 관련된 사항이 데이터 모델링에 반영될 수 있도록 하는 것
* 데이터의 증가가 빠를수록, 성능 저하에 따른 성능 개선비용은 증가한다
* 데이터모델은 성능을 튜닝하면서 변경이 될 수 있다는 특징이 있다
* 분석/설계 단계에서 성능을 고려한 데이터모델링을 수행할 경우 성능 저하에 따른 Rework 비용을 최소화 할 수 있는 기회를 가지게 된다.

#### 성능 데이터 모델링 수행 절차

1. 데이터모델링을 할 때 <u>정규화</u>를 정확하게 수행한다.
   * 기본적으로 중복된 데이터를 제거함으로써 조회성능을 향상시킬 수 있음
2. <u>데이터베이스 용량산정</u>을 수행한다.
   * 전체적인 데이터베이스에 발생되는 트랜잭션의 유형과 양을 분석하는 자료가 되므로, 성능데이터 모델링을 할 때 중요한 작업이다.
3. 데이터베이스에 발생되는 <u>트랜잭션의 유형</u>을 파악한다.
4. <u>용량과 트랜잭션의 유형</u>에 따라 <u>반정규화(역정규화)</u>를 수행한다
5. <u>이력모델의 조정, PK(Primary Key)/FK(Foreign Key)조정, 슈퍼타입/서브타입 조정</u> 등을 수행한다.
   * 이력데이터는 시간에 따라 반복적으로 발생이 되기 때문에 대량 데이터일 가능성이 높아 특별히 성능을 고려하여 칼럼 등을 추가하도록 설계해야 한다. 
6. <u>성능관점</u>에서 데이터모델을 <u>검증</u>한다

#### 정규화(Normalization)

* 정규화(Normalization)의 기본 목표는 테이블 간에 중복된 데이터를 허용하지 않는다는 것
* 중복된 데이터를 허용하지 않음으로서 무결성(integrity)을 유지할 수 있으며, DB의 저장 용량도 줄일 수 있다

#### 정규화 단계

* 1차 정규화

  테이블의 컬럼이 원자값(Atomic Value, 하나의 값)을 갖도록 테이블을 분해하는 것

  ![Screen Shot 2023-03-11 at 1.48.57 AM](/Users/gyumin/Desktop/TodayILearned/2023/SQLD/assets/Screen Shot 2023-03-11 at 1.48.57 AM.png)

* 2차 정규화

  * 1차 정규화를 진행한 테이블에 대해 <u>**완전 함수 종속**(기본키의 부분집합이 결정자가 되어선 안된다는 것)</u>을 만족하도록 테이블을 분해하는 것

  * <u>중복속성에 대한 분리</u> (로우단위의 중복, 칼럼 단위의 중복 모두 1차 정규화의 대상)

* 3차 정규화

  * 2차 정규화를 진행한 테이블에 대해 <u>**이행적 종속**(A->B, B->C일 때 A->C)</u>을 없애도록 테이블을 분해하는 것

* BCNF 정규화

  * 3차 정규화를 진행한 테이블에 대해 **모든 결정자가 후보키**가 되도록 테이블을 분해하는 것

#### 반정규화

* 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발(Development)과 운영(Maintenance)의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법을 의미

* 데이터를 중복하여 성능을 향상시키기 위한 기법
* 성능을 향상시키기 위해 정규화된 데이터모델에서 중복, 통합, 분리 등을 수행하는 모든 과정을 의미

#### 반정규화 판단요소

* 반정규화 정보에 대한 재현의 적시성
  * 빌링의 잔액(balance)은 다수 테이블에 대한 다량의 조인이 불가피하므로 데이터 제공의 적시성 확보를 위한 필수 반정규화 대상 정보임
* 탐색 대상 데이터의 크기로만 판단하는 것은 아님
  * 다량 데이터 탐색의 경우 인덱스가 아닌 파티션 및 데이터 클러스터링 등의 다양한 물리 저장 기법을 활용하여 성능 개선을 유도할 수 있다. **다만**, 하나의 결과셋을 수출하기 위해 다량의 데이터를 탐색하는 처리가 <u>반복적으로 빈번</u>하게 발생한다면 이때는 반정규화를 고려하는 것이 좋다
  
* RDBMS는 현재 레코드 기준 이전 또는 이후 위치의 레코드에 대한 탐색은 window function으로 접근 가능하므로 반정규화가 필요하지는 않다
* 반정규화 테이블은 집계 테이블 이외에도 다양한 유형(다수 테이블의 키 연결 테이블 등)에 대하여 반정규화 테이블 적용이 필요할 수 있다
* 데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 데이터를 중복하여 반정규화를 적용하는 이유
  * 데이터를 조회할 때 디스크 I/O량이 많아서 성능이 저하되거나 
  * 경로가 너무 멀어 조인으로 인한 성능저하가 예상되거나 
  * 칼럼을 계산하여 읽을 때 성능이 저하될 것이 예상되는 경우

#### 테이블의 반정규화 기법

| 기법분류          | 반정규화 기법                                                |
| ----------------- | ------------------------------------------------------------ |
| 테이블<u>병합</u> | **1:1 관계 테이블병합**                                      |
|                   | **1:M 관계 테이블병합**                                      |
|                   | **슈퍼/서브타입 테이블병합**                                 |
| 테이블<u>분할</u> | **수직분할**<br />*<u>칼럼별 사용빈도</u>의 차이가 많은 경우 <br />자주 사용되는 칼럼들과 그렇지 않은 칼럼으로 분류하여 테이블을 분할하는 방법* |
|                   | **수평분할**<br />*<u>특정 범위별 사용 빈도</u>의 차이가 많은 경우 <u>해당 범위 별</u>로 테이블을 분할하는 방법* |
| 테이블<u>추가</u> | **중복테이블 추가**<br />*다량의 범위를 자주 처리하는 경우<br />특정 범위의 데이터만 자주 처리되는 경우<br />처리범위를 줄이지 않고는 수행속도를 개선할 수 없는 경우* |
|                   | **통계테이블 추가**                                          |
|                   | **이력테이블 추가**                                          |
|                   | **부분테이블 추가**<br />*하나의 테이블의 전체 칼럼 중 자주 이용하는 집중화된 칼럼들이 있을 때, <br />디스크 I/O를 줄이기 위해 해당 칼럼들을 별도로 모아 놓는 반 정규화 기법* |

#### 칼럼의 반정규화 기법

|           반정규화 기법           | 이유                                                         |
| :-------------------------------: | ------------------------------------------------------------ |
|           중복칼럼 추가           | 조인감소를 위해 여러 테이블에 동일한 칼럼을 가지도록 함      |
|           파생칼럼 추가           | 조회 성능을 우수하게 하기 위해 미리 계산된 칼럼을 가지도록 함 |
|        이력테이블 칼럼추가        | 기능칼럼 추가 - 최신값을 처리하니 이력테이블 특성을 고려하여 기능성 칼럼 추가 |
|        PK에 의한 칼럼추가         |                                                              |
| 응용시스템 오작동을 위한 칼럼추가 |                                                              |

#### 반정규화 절차

1. 반정규화 대상조사
   * 범위처리빈도수 조사
   * 대량의 범위 처리 조사
   * 통계성 프로세스 조사
   * 테이블 조인 개수
2. 다른 방법유도 검토
   * 뷰(VIEW) 테이블
     * 지나치게 많은 조인이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우
   * 클러스터링 적용 / 인덱스의 조정
     * 대량의 데이터처리나 부분처리에 의해 성능이 저하되는 경우
   * 파티셔닝 기법
     * 대량의 데이터는 Primary Key의 성격에 따라 부분적인 테이블로 분리할 수 있다
     * 논리적으로는 하나의 테이블이지만, 물리적으로는 여러 개의 테이블로 분리하여 데이터 액세스 성능 향상 및 데이터 관리방법도 개선 가능
   * 응용애플리케이션
     * 응용 애플리케이션에서 로직을 구사하는 방법을 변경함으로써 성능을 향상시킬 수 있다
3. 반정규화 적용
   * 테이블 반정규화
   * 속성의 반정규화
   * 관계의 반정규화

#### 슈퍼/서브 타입 데이터 모델의 변환기술

* 개별로 발생되는 트랜잭션에 대해서는 개별 테이블로 구성
* 슈퍼타입+서브타입에 대해 발생되는 트랜잭션에 대해서는 슈퍼타입+서브타입 테이블로 구성
* 전체를 하나로 묶어 트랜잭션이 발생할 때는 하나의 테이블로 구성

* 트랜잭션은 항상 전체를 대상으로 일괄 처리하는데 테이블은 서브타입별로 개별 유지하는 것으로 변환하면 Union 연산에 의해 성능이 저하될 수 있다.
* 트랜잭션은 항상 서브타입 개별로 처리하는데 테이블은 하나로 통합하여 변환하면 불필요하게 많은 양의 데이터가 집적되어 있어 성능이 저하될 수 있다.
* 트랜잭션은 항상 슈퍼+서브 타입을 함께 처리하는데 개별로 유지하면 조인에 의해 성능이 저하될 수 있다.
* 트랜잭션은 항상 전체를 통합하여 분석 처리하는데 슈퍼-서브타입이 하나의 테이블로 통합되어 있으면 하나의 테이블에 집적된 데이터만 읽어 처리할 수 있기 때문에 다른 형식에 비해 더 성능이 우수하다(조인 감소)

 #### PK순서를 결정하는 기준

* 인덱스의 특징은 여러 개의 속성이 하나의 인덱스로 구성되어 있을 때 <u>앞쪽에 위치한 속성의 값이 비교자</u>로 있어야 좋은 효율을 나타낼 수 있다.
* 앞쪽에 위치한 속성 값이 가급적 '=' 아니면 최소한 범위 'BETWEEN' '< >'가 들어와야 인덱스를 이용할 수 있는 것이다.

#### 분산 데이터베이스의 장단점

* 장점
  * 지역 자치성, 점증적 시스템 용량 확장
  * 신뢰성과 가용성
  * 효용성과 융통성
  * 빠른 응답 속도와 통신비용 절감
  * 데이터의 가용성과 신뢰성 증가
  * 시스템 규모의 적절한 조절
  * 각 지역 사용자의 요구 수용 증대
* 단점
  * 소프트웨어 개발 비용
  * 오류의 잠재성 증대
  * 처리 비용의 증대
  * 설계, 관리의 복잡성과 비용
  * 불규칙한 응답 속도
  * 통제의 어려움
  * 데이터 무결성에 대한 위협

#### 데이터베이스 분산설계를 적용해 효율성을 증대시킬 수 있는 환경

* 공통코드, 기준정보 등 마스터 데이터는 분산데이터베이스에 복제분산을 적용한다
* 거의 실시간(Near Real Time) 업무적인 특성을 가지고 있을 때 분산데이터베이스 사용해 구성가능
* 백업 사이트 구성시 간단하게 분산 기능을 적용하여 구성가능

#### 통합데이터베이스 구조(Global Single Instance)

* 분산데이터베이스와 대치되는 개념 



## 🔗 참고 

- [Database] 정규화(Normalization) 쉽게 이해하기 https://mangkyu.tistory.com/110



